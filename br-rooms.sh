#!/bin/bash

# ---------- ROOMS ----------
ROOM_OUTSIDE=(
"ğŸŒ³ğŸŒ³ğŸŒ³ğŸŒ³ğŸŒ³ğŸŒ³ğŸŒ³ğŸŒ³ğŸŒ³ğŸŒ³"
"ğŸŒ³â¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œğŸŒ³"
"ğŸŒ³â¬œğŸ â¬œâ¬œâ¬œğŸªâ¬œâ¬œğŸŒ³"
"ğŸŒ³â¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œğŸŒ³"
"ğŸŒ³â¬œâ¬œâ¬œğŸŒ¾ğŸŒ¾â¬œâ¬œâ¬œğŸŒ³"
"ğŸŒ³â¬œâ¬œâ¬œğŸŒ¾ğŸŒ¾â¬œâ¬œâ¬œğŸŒ³"
"ğŸŒ³â¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œğŸŒ³"
"ğŸŒ³â¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œğŸŒ³"
"ğŸŒ³â¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œğŸŒ³"
"ğŸŒ³ğŸŒ³ğŸŒ³ğŸŒ³ğŸšªğŸŒ³ğŸŒ³ğŸŒ³ğŸŒ³ğŸŒ³"
)

ROOM_HOUSE=(
"â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›"
"â¬›ğŸªŸâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œğŸªŸâ¬›"
"â¬›â¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬›"
"â¬›â¬œâ¬œğŸ›‹ï¸â¬œâ¬œğŸª‘â¬œâ¬œâ¬›"
"â¬›â¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬›"
"â¬›â¬œâ¬œğŸ“ºâ¬œâ¬œâ¬œğŸ›ï¸â¬œâ¬›"
"â¬›â¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬›"
"â¬›â¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬›"
"â¬›â¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬›"
"â¬›â¬›â¬›â¬›ğŸšªâ¬›â¬›â¬›â¬›â¬›"
)

ROOM_STORE=(
"â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›â¬›"
"â¬›ğŸ›’â¬œâ¬œâ¬œâ¬œâ¬œâ¬œğŸ›’â¬›"
"â¬›â¬œâ¬œğŸ¥«ğŸ¥›ğŸâ¬œâ¬œâ¬œâ¬›"
"â¬›â¬œâ¬œğŸğŸŒğŸ‡â¬œâ¬œâ¬œâ¬›"
"â¬›â¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬›"
"â¬›â¬œâ¬œğŸ’³â¬œâ¬œğŸ§¾â¬œâ¬œâ¬›"
"â¬›â¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬›"
"â¬›â¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬›"
"â¬›â¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬›"
"â¬›â¬›â¬›â¬›ğŸšªâ¬›â¬›â¬›â¬›â¬›"
)

# ---------- STATE ----------
CURRENT_ROOM="outside"
GRID=("${ROOM_OUTSIDE[@]}")
PX=4
PY=4

load_room() {
  CURRENT_ROOM="$1"
  case "$1" in
    outside) GRID=("${ROOM_OUTSIDE[@]}"); PX=4; PY=8;;
    house)   GRID=("${ROOM_HOUSE[@]}");   PX=4; PY=1;;
    store)   GRID=("${ROOM_STORE[@]}");   PX=4; PY=1;;
  esac
}

draw() {
  clear
  for y in "${!GRID[@]}"; do
    row="${GRID[$y]}"
    if [[ $y -eq $PY ]]; then
      echo "${row:0:$PX}ğŸ§ ${row:$((PX+1))}"
    else
      echo "$row"
    fi
  done
  echo
  echo "Room: $CURRENT_ROOM Â· WASD move Â· Q quit"
}

can_move() {
  local nx=$1 ny=$2
  [[ "${GRID[$ny]:$nx:1}" != "â¬›" && "${GRID[$ny]:$nx:1}" != "ğŸŒ³" ]]
}

handle_door() {
  if [[ "${GRID[$PY]:$PX:1}" == "ğŸšª" ]]; then
    case "$CURRENT_ROOM" in
      outside) load_room "house";;
      house)   load_room "outside";;
      store)   load_room "outside";;
    esac
  fi
}

draw
while true; do
  read -rsn1 key
  case "$key" in
    w|W) nx=$PX; ny=$((PY-1));;
    s|S) nx=$PX; ny=$((PY+1));;
    a|A) nx=$((PX-1)); ny=$PY;;
    d|D) nx=$((PX+1)); ny=$PY;;
    q|Q) clear; exit 0;;
    *) continue;;
  esac
  if can_move "$nx" "$ny"; then
    PX=$nx; PY=$ny
    handle_door
  fi
  draw
done
