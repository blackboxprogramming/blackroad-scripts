#!/bin/bash
echo "ğŸ¥ Pironman Diagnostic - Powered On But Not Responding"
echo "======================================================"
echo ""

echo "ğŸ“‹ Symptoms:"
echo "  â€¢ Pironmans are powered on (confirmed by user)"
echo "  â€¢ Not responding to ping"
echo "  â€¢ No MAC addresses visible in ARP"
echo "  â€¢ No SSH connections successful"
echo ""

echo "ğŸ¤” Possible Causes:"
echo ""
echo "1. Boot Failure (most likely for octavia):"
echo "   â†’ Disk full prevents complete boot"
echo "   â†’ Network stack doesn't start"
echo "   â†’ Need monitor/keyboard to see errors"
echo ""
echo "2. Different Subnet:"
echo "   â†’ TP-Link configured as router with NAT"
echo "   â†’ Pironmans on 192.168.0.x or 192.168.1.x"
echo "   â†’ Need to access TP-Link management first"
echo ""
echo "3. SSH Not Enabled:"
echo "   â†’ Fresh install without SSH configured"
echo "   â†’ Need to enable via raspi-config"
echo "   â†’ Requires monitor/keyboard access"
echo ""
echo "4. Firewall/Network Config:"
echo "   â†’ Pi firewall blocking connections"
echo "   â†’ Static IP misconfigured"
echo "   â†’ Wrong gateway/subnet mask"
echo ""

echo "ğŸ¯ SOLUTIONS:"
echo ""
echo "â•â•â• IMMEDIATE ACTION (Physical Access) â•â•â•"
echo ""
echo "Connect HDMI + Keyboard to each Pironman:"
echo "  1. Watch what's on screen - is it booted?"
echo "  2. Check if login prompt appears"
echo "  3. Login and check network:"
echo "     â†’ hostname -I          # What's my IP?"
echo "     â†’ ip addr show         # Network config"
echo "     â†’ sudo systemctl status ssh   # Is SSH running?"
echo "     â†’ df -h                # Disk space"
echo ""
echo "If octavia is stuck at boot:"
echo "  1. Power off"
echo "  2. Hold SHIFT while powering on (recovery menu)"
echo "  3. Or edit /boot/cmdline.txt: add 'init=/bin/bash'"
echo "  4. Clean disk space"
echo "  5. Reboot"
echo ""

echo "â•â•â• CHECK TP-LINK DEVICE â•â•â•"
echo ""
echo "1. Find TP-Link physical device"
echo "2. Check for management IP on label"
echo "3. Access web interface from browser"
echo "4. Look at DHCP client list"
echo "5. Check if Pironmans got IPs there"
echo ""

echo "â•â•â• ENABLE SSH (if needed) â•â•â•"
echo ""
echo "If you can login via keyboard but SSH isn't working:"
echo "  sudo systemctl enable ssh"
echo "  sudo systemctl start ssh"
echo "  sudo ufw allow 22   # if firewall enabled"
echo ""

echo "â•â•â• CHECK FROM PIRONMAN CONSOLE â•â•â•"
echo ""
echo "Once logged in via keyboard:"
echo "  # What's my IP?"
echo "  hostname -I"
echo "  "
echo "  # Can I reach the Mac?"
echo "  ping 192.168.4.28"
echo "  "
echo "  # Is SSH running?"
echo "  sudo systemctl status ssh"
echo "  "
echo "  # Network config"
echo "  ip addr show eth0"
echo "  "
echo "  # Check routes"
echo "  ip route"
echo ""

echo "ğŸ’¡ MOST LIKELY: octavia has disk full and can't complete boot"
echo "   â†’ Connect monitor to see boot errors"
echo "   â†’ Boot to recovery"
echo "   â†’ Clear disk space"
echo "   â†’ Normal boot should work then"
echo ""

echo "ğŸ“ Report back what you see on the monitors!"
